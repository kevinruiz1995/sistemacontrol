{% extends 'panelbase.html' %}
{% load static %}
{% load funciones_especiales %}
{% block head %}
    <style>
        /* static/css/modal.css */
        #modalCamara {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            max-width: 50%; /* Ajusta según sea necesario */
            max-height: 50%; /* Ajusta según sea necesario */
            overflow: auto;
            display: flex;
            flex-direction: column;
        }

        .modal-content {
            flex: 1;
        }

        .modal-footer {
            margin-top: auto; /* Hace que el pie de página esté en la parte inferior */
        }

    </style>

    <style>
        /* Estilos para el contenedor de la animación de carga */
        #loader-container {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
        }

        /* Estilos para la animación de carga */
        #loader {
            border: 16px solid #f3f3f3;
            border-top: 16px solid #3498db;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

    </style>


    <script>

        function mostrarFechaHora() {
            // Obtiene el elemento donde se mostrará la fecha y hora
            const fechaHoraElemento = document.getElementById('fecha-hora');

            // Función para obtener la fecha y hora actual
            function obtenerFechaHoraActual() {
                const ahora = new Date();
                const fecha = ahora.toLocaleDateString('es-ES');
                const hora = ahora.toLocaleTimeString('es-ES');
                return `${fecha} - ${hora}`;
            }

            // Función para actualizar la fecha y hora cada segundo
            function actualizarFechaHora() {
                const fechaHora = obtenerFechaHoraActual();
                fechaHoraElemento.textContent = fechaHora;
            }

            // Llama a la función por primera vez para evitar retrasos
            actualizarFechaHora();

            // Actualiza la fecha y hora cada segundo
            setInterval(actualizarFechaHora, 1000);
        }

        function inicializarCamara() {
            var video = document.getElementById('video');

            // Verificar si el navegador es compatible con getUserMedia
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                // Acceder a la cámara y configurar el flujo de video en el elemento video
                navigator.mediaDevices.getUserMedia({video: true})
                    .then(function (stream) {
                        video.srcObject = stream;
                    })
                    .catch(function (error) {
                        console.error('Error al acceder a la cámara:', error);
                    });
            } else {
                console.error('getUserMedia no es soportado en este navegador.');
            }
        }

        document.addEventListener("DOMContentLoaded", function () {
            inicializarCamara();
            mostrarFechaHora();
        })
    </script>
{% endblock %}
{% block contenido %}

    <div class="col-md-12 mb-lg-0 mb-4">
        <div class="position-relative card mt-1">
            <div class="card-header pb-0 p-3">
                <!-- Contenido del encabezado de la tarjeta (opcional) -->
            </div>
            <form method="get" action="">
                <div class="card-header pb-0 p-3">
                    <!-- Contenido del encabezado del formulario (opcional) -->
                </div>
            </form>
            <div class="card-body p-3" style="text-align:center">
                <div style="text-align: left;width: 100%">
                    <h3>Bienvenido, {{ persona_logeado }}</h3>
                    <b><h4>Mi jornada: </h4> {{ jornadaempleado }}</b>
                </div>
                <div class="modal-body d-flex justify-content-center align-items-center"
                     style="width: 300px; height: 300px; border-radius: 50%; overflow: hidden; position: relative;left: 40%">
                    <div id="loader-container">
                        <div id="loader"></div>
                    </div>
                    <video id="video" width="100%" height="100%"
                           style="object-fit: cover; border-radius: 50%; position: absolute;"
                           autoplay></video>
                </div>
                <br>
                <p><b id="fecha-hora"></b></p>
                <button type="submit" class="btn btn-success">Registrar marcada</button>
                <a class="btn btn-danger" href="/">Cancelar</a>
            </div>
        </div>
    </div>





{% endblock %}

{% block script %}
    <script type="text/javascript">

    </script>
{% endblock %}